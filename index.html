<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calendario de Adviento - Casino F√©nix</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #1a0e0e 0%, #2d1810 50%, #1a0e0e 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow-x: hidden;
      position: relative;
    }

    /* Added preloader styles */
    .preloader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1a0e0e 0%, #2d1810 50%, #1a0e0e 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .preloader.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .preloader-logo {
      max-width: 200px;
      margin-bottom: 40px;
      animation: pulse 2s ease-in-out infinite;
      filter: drop-shadow(0 0 20px rgba(255, 140, 0, 0.6));
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.9; }
    }

    .progress-bar-container {
      width: 300px;
      height: 8px;
      background: rgba(255, 140, 0, 0.2);
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      box-shadow: 0 0 20px rgba(255, 140, 0, 0.3);
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #ff8c00, #ffd700, #ff8c00);
      background-size: 200% 100%;
      border-radius: 10px;
      width: 0%;
      animation: loadProgress 2s ease-out forwards, shimmerBar 1.5s linear infinite;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
    }

    @keyframes loadProgress {
      0% { width: 0%; }
      100% { width: 100%; }
    }

    @keyframes shimmerBar {
      0% { background-position: 0% 50%; }
      100% { background-position: 200% 50%; }
    }

    .loading-text {
      margin-top: 20px;
      color: #ffd700;
      font-size: 1.2rem;
      font-weight: 600;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    /* Part√≠culas de fondo */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(2px 2px at 20% 30%, rgba(255, 165, 0, 0.3), transparent),
        radial-gradient(2px 2px at 60% 70%, rgba(255, 140, 0, 0.3), transparent),
        radial-gradient(1px 1px at 50% 50%, rgba(255, 215, 0, 0.2), transparent);
      background-size: 200px 200px, 300px 300px, 250px 250px;
      animation: particles 20s linear infinite;
      pointer-events: none;
      z-index: 0;
    }

    @keyframes particles {
      0% { transform: translateY(0); }
      100% { transform: translateY(-100px); }
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      position: relative;
      z-index: 1;
    }

    .logo {
      max-width: 180px;
      height: auto;
      margin-bottom: 15px;
      filter: drop-shadow(0 4px 12px rgba(255, 140, 0, 0.5));
    }

    h1 {
      font-size: clamp(1.8rem, 5vw, 3rem);
      font-weight: 800;
      background: linear-gradient(135deg, #ff8c00, #ffd700, #ff8c00);
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: shimmer 3s ease-in-out infinite;
      text-shadow: 0 0 30px rgba(255, 140, 0, 0.5);
      margin-bottom: 10px;
    }

    @keyframes shimmer {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .subtitle {
      color: #ffd700;
      font-size: clamp(1rem, 2.5vw, 1.3rem);
      font-weight: 600;
      text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
    }

    /* Contenedor del √°rbol */
    .tree-container {
      position: relative;
      max-width: 700px;
      width: 100%;
      margin: 0 auto;
      z-index: 1;
    }

    /* Updated tree SVG for better proportions */
    .tree-svg {
      width: 100%;
      height: auto;
      filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.5));
    }

    /* Contenedor de cajitas: grilla dentro del √°rbol */
    .boxes-container {
      position: absolute;
      inset: 10% 25% 22% 25%; /* top, right, bottom, left: ajust√° si quer√©s afinar */
      display: grid;
      grid-template-columns: repeat(7, 1fr);  /* 7 columnas para dibujar la pir√°mide */
      grid-template-rows: repeat(7, 1fr);     /* 7 filas (1‚Äì6 y 25) */
      pointer-events: none;                   /* dejamos que solo las cajas reciban clic */
      z-index: 2;
    }

    /* Cajita individual */
    .box {
      position: relative;
      width: 55px;
      height: 55px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      pointer-events: all;
      transform-origin: center;
      justify-self: center;  /* centra cada caja dentro de su celda de grilla */
      align-self: center;
    }

    .box:hover:not(.locked) {
      transform: scale(1.15) rotate(5deg);
    }

    .box.locked {
      cursor: not-allowed;
      opacity: 0.5;
      filter: grayscale(70%);
    }

    .box.claimed {
      opacity: 0.6;
      filter: brightness(0.7);
    }

    .box-inner {
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #ff8c00 0%, #ff6b00 100%);
      border: 3px solid #ffd700;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(255, 140, 0, 0.4);
      position: relative;
      overflow: hidden;
    }

    .box.locked .box-inner {
      background: linear-gradient(135deg, #4a3428 0%, #2d1f18 100%);
      border-color: #6b5344;
    }

    .box.claimed .box-inner {
      background: linear-gradient(135deg, #8b6914 0%, #6b5414 100%);
    }

    .box-number {
      font-size: 1.4rem;
      font-weight: 800;
      color: white;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      z-index: 2;
    }

    .box.locked .box-number {
      color: #8b7355;
    }

    .box-icon {
      font-size: 1.2rem;
      position: absolute;
      bottom: 5px;
      opacity: 0.6;
    }

    /* Shine effect se queda igual */
    .box:not(.locked):not(.claimed) .box-inner::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: shine 3s infinite;
    }

    /* POSICIONES: pir√°mide dentro de la grilla */

    /* Fila 1: 1 caja */
    .box[data-day="1"]  { grid-column: 4; grid-row: 1; }

    /* Fila 2: 2 cajas */
    .box[data-day="2"]  { grid-column: 3; grid-row: 2; }
    .box[data-day="3"]  { grid-column: 5; grid-row: 2; }

    /* Fila 3: 3 cajas */
    .box[data-day="4"]  { grid-column: 2; grid-row: 3; }
    .box[data-day="5"]  { grid-column: 4; grid-row: 3; }
    .box[data-day="6"]  { grid-column: 6; grid-row: 3; }

    /* Fila 4: 5 cajas */
    .box[data-day="7"]  { grid-column: 2; grid-row: 4; }
    .box[data-day="8"]  { grid-column: 3; grid-row: 4; }
    .box[data-day="9"]  { grid-column: 4; grid-row: 4; }
    .box[data-day="10"] { grid-column: 5; grid-row: 4; }
    .box[data-day="11"] { grid-column: 6; grid-row: 4; }

    /* Fila 5: 6 cajas */
    .box[data-day="12"] { grid-column: 1; grid-row: 5; }
    .box[data-day="13"] { grid-column: 2; grid-row: 5; }
    .box[data-day="14"] { grid-column: 3; grid-row: 5; }
    .box[data-day="15"] { grid-column: 4; grid-row: 5; }
    .box[data-day="16"] { grid-column: 5; grid-row: 5; }
    .box[data-day="17"] { grid-column: 6; grid-row: 5; }

    /* Fila 6: 7 cajas */
    .box[data-day="18"] { grid-column: 1; grid-row: 6; }
    .box[data-day="19"] { grid-column: 2; grid-row: 6; }
    .box[data-day="20"] { grid-column: 3; grid-row: 6; }
    .box[data-day="21"] { grid-column: 4; grid-row: 6; }
    .box[data-day="22"] { grid-column: 5; grid-row: 6; }
    .box[data-day="23"] { grid-column: 6; grid-row: 6; }
    .box[data-day="24"] { grid-column: 7; grid-row: 6; }

    /* Fila 7: caja 25 (tronco) */
    .box[data-day="25"] { grid-column: 4; grid-row: 7; width: 65px; height: 65px; }


    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(5px);
      animation: fadeIn 0.3s ease;
    }

    .modal.active {
      display: flex;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: linear-gradient(135deg, #2d1810 0%, #1a0e0e 100%);
      border: 3px solid #ff8c00;
      border-radius: 20px;
      padding: 40px;
      max-width: 500px;
      width: 90%;
      text-align: center;
      position: relative;
      box-shadow: 0 20px 60px rgba(255, 140, 0, 0.4);
      animation: modalBounce 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes modalBounce {
      0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
      50% { transform: scale(1.05) rotate(2deg); }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }

    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: rgba(255, 140, 0, 0.2);
      border: 2px solid #ff8c00;
      color: #ffd700;
      font-size: 1.5rem;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .modal-close:hover {
      background: #ff8c00;
      transform: rotate(90deg);
    }

    .modal-day {
      font-size: 1.2rem;
      color: #ffd700;
      font-weight: 600;
      margin-bottom: 20px;
    }

    .modal-prize {
      font-size: 3rem;
      font-weight: 800;
      background: linear-gradient(135deg, #ff8c00, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 20px 0;
      text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
    }

    .modal-message {
      color: #fff;
      font-size: 1.1rem;
      line-height: 1.6;
      margin-top: 15px;
    }

    /* Confetti */
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      pointer-events: none;
      z-index: 9999;
      animation: confettiFall linear forwards;
    }

    @keyframes confettiFall {
      0% {
        transform: translateY(-100vh) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }

    /* Footer */
    .footer {
      position: relative;
      z-index: 1;
      margin-top: 30px;
      text-align: center;
      color: #ffd700;
      font-size: 0.9rem;
      opacity: 0.8;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .box {
        width: 45px;
        height: 45px;
      }

      .box[data-day="25"] {
        width: 55px;
        height: 55px;
      }

      .box-number {
        font-size: 1.2rem;
      }

      .box-icon {
        font-size: 1rem;
      }
    }

    @media (max-width: 480px) {
      .box {
        width: 35px;
        height: 35px;
      }

      .box[data-day="25"] {
        width: 45px;
        height: 45px;
      }

      .box-number {
        font-size: 1rem;
      }

      .box-icon {
        font-size: 0.8rem;
        bottom: 2px;
      }

      .modal-content {
        padding: 30px 20px;
      }

      .preloader-logo {
        max-width: 150px;
      }

      .progress-bar-container {
        width: 250px;
      }
    }
  </style>
</head>
<body>

  <!-- Added preloader -->
  <div class="preloader" id="preloader">
    <img src="assets/logo.png" alt="Casino F√©nix" class="preloader-logo">
    <div class="progress-bar-container">
      <div class="progress-bar"></div>
    </div>
    <div class="loading-text">Cargando calendario...</div>
  </div>

  <div class="header">
    <img src="assets/logo.png" alt="Casino F√©nix" class="logo" id="logo">
    <h1>Calendario de Adviento</h1>
    <p class="subtitle">¬°Reclama tu premio diario hasta Navidad!</p>
  </div>

  <div class="tree-container">
    <!-- √Årbol de Navidad SVG -->
    <svg class="tree-svg" viewBox="0 0 300 380" xmlns="http://www.w3.org/2000/svg">
      <!-- Cuerpo del √°rbol -->
      <path d="M150 20 L110 80 L130 80 L90 140 L115 140 L75 200 L110 200 L60 270 L115 270 L50 350 L250 350 L185 270 L240 270 L190 200 L225 200 L185 140 L210 140 L170 80 L190 80 Z" 
            fill="#2d3e2d" 
            stroke="#1a2a1a" 
            stroke-width="2"/>
      
      <!-- Tronco -->
      <rect x="130" y="350" width="40" height="30" 
            fill="#4a3428" 
            stroke="#2d1f18" 
            stroke-width="2"/>
      
      <!-- Estrella en la punta -->
      <path d="M150 5 L155 18 L169 18 L158 26 L163 39 L150 31 L137 39 L142 26 L131 18 L145 18 Z" 
            fill="#ffd700" 
            stroke="#ff8c00" 
            stroke-width="1.5"/>
    </svg>

    <!-- Contenedor de cajitas -->
    <div class="boxes-container" id="boxesContainer"></div>
  </div>

  <div class="footer">
    <p>Casino F√©nix - Calendario de Adviento 2024</p>
  </div>

  <!-- Modal de premio -->
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="modalPrize">
    <div class="modal-content">
      <button class="modal-close" id="modalClose" aria-label="Cerrar">&times;</button>
      <div class="modal-day" id="modalDay"></div>
      <div class="modal-prize" id="modalPrize"></div>
      <div class="modal-message" id="modalMessage"></div>
    </div>
  </div>

  <audio id="audio" src="assets/sound.mp3" preload="auto"></audio>

  <script>
    window.addEventListener('load', () => {
      setTimeout(() => {
        document.getElementById('preloader').classList.add('hidden');
      }, 2100);
    });

    // Sistema de premios ponderados
    const premios = [
      { valor: '10,000 Fichas', peso: 0.5, tipo: 'fichas' },
      { valor: '5,000 Fichas', peso: 2, tipo: 'fichas' },
      { valor: '2,500 Fichas', peso: 5, tipo: 'fichas' },
      { valor: '1,000 Fichas', peso: 10, tipo: 'fichas' },
      { valor: '500 Fichas', peso: 15, tipo: 'fichas' },
      { valor: 'Bono del 200%', peso: 5, tipo: 'bono' },
      { valor: 'Bono del 150%', peso: 10, tipo: 'bono' },
      { valor: 'Bono del 100%', peso: 42.5, tipo: 'bono' },
      { valor: '50 Giros Gratis', peso: 10, tipo: 'giros' }
    ];

    function pickWeighted(items) {
      const totalWeight = items.reduce((sum, item) => sum + item.peso, 0);
      let random = Math.random() * totalWeight;
      for (const item of items) {
        random -= item.peso;
        if (random <= 0) return item;
      }
      return items[items.length - 1];
    }

    // Obtener d√≠a actual (para pruebas, puedes cambiar esto)
    function getCurrentDay() {
      const now = new Date();
      // Para pruebas, descomenta la siguiente l√≠nea para simular un d√≠a espec√≠fico
      // return 15; // Simula que estamos en el d√≠a 15
      
      // Solo en diciembre
      if (now.getMonth() === 11) { // Diciembre es mes 11 (0-indexed)
        return now.getDate();
      }
      
      // Para pruebas fuera de diciembre, retorna un d√≠a simulado
      return 1; // Cambia esto para probar diferentes d√≠as
    }

    // LocalStorage para premios reclamados
    const STORAGE_KEY = 'advent_calendar_claims';

    function getClaimedDays() {
      const data = localStorage.getItem(STORAGE_KEY);
      return data ? JSON.parse(data) : {};
    }

    function saveClaim(day, prize) {
      const claims = getClaimedDays();
      claims[day] = {
        prize: prize,
        timestamp: new Date().toISOString()
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(claims));
    }

    function isDayClaimed(day) {
      const claims = getClaimedDays();
      return claims.hasOwnProperty(day);
    }

    function getClaimedPrize(day) {
      const claims = getClaimedDays();
      return claims[day]?.prize || null;
    }

    // Crear cajitas
    function createBoxes() {
      const container = document.getElementById('boxesContainer');
      const currentDay = getCurrentDay();

      for (let day = 1; day <= 25; day++) {
        const box = document.createElement('div');
        box.className = 'box';
        box.setAttribute('data-day', day);
        
        const isLocked = day > currentDay;
        const isClaimed = isDayClaimed(day);
        
        if (isLocked) {
          box.classList.add('locked');
        }
        
        if (isClaimed) {
          box.classList.add('claimed');
        }

        box.innerHTML = `
          <div class="box-inner">
            <div class="box-number">${day}</div>
            <div class="box-icon">${isClaimed ? '‚úì' : (isLocked ? 'üîí' : 'üéÅ')}</div>
          </div>
        `;

        if (!isLocked) {
          box.addEventListener('click', () => openBox(day));
        }

        container.appendChild(box);
      }
    }

    // Abrir cajita
    function openBox(day) {
      const claimed = isDayClaimed(day);
      let prize;

      if (claimed) {
        // Mostrar premio ya reclamado
        prize = getClaimedPrize(day);
      } else {
        // Generar nuevo premio
        const selectedPrize = pickWeighted(premios);
        prize = selectedPrize.valor;
        saveClaim(day, prize);
        
        // Marcar como reclamado visualmente
        const box = document.querySelector(`.box[data-day="${day}"]`);
        box.classList.add('claimed');
        box.querySelector('.box-icon').textContent = '‚úì';
        
        // Confetti
        launchConfetti();
        
        // Audio
        playAudio();
      }

      showModal(day, prize, claimed);
    }

    // Modal
    function showModal(day, prize, alreadyClaimed) {
      const modal = document.getElementById('modal');
      const modalDay = document.getElementById('modalDay');
      const modalPrize = document.getElementById('modalPrize');
      const modalMessage = document.getElementById('modalMessage');

      modalDay.textContent = `D√≠a ${day} de Diciembre`;
      modalPrize.textContent = prize;
      
      if (alreadyClaimed) {
        modalMessage.innerHTML = '¬°Ya reclamaste este premio!<br>Vuelve ma√±ana por uno nuevo.';
      } else {
        modalMessage.innerHTML = '¬°Felicidades!<br>Tu premio ha sido agregado a tu cuenta.';
      }

      modal.classList.add('active');
    }

    function closeModal() {
      const modal = document.getElementById('modal');
      modal.classList.remove('active');
    }

    document.getElementById('modalClose').addEventListener('click', closeModal);
    document.getElementById('modal').addEventListener('click', (e) => {
      if (e.target.id === 'modal') closeModal();
    });

    // Confetti
    function launchConfetti() {
      const colors = ['#ff8c00', '#ffd700', '#ff6b00', '#ffed4e', '#ff4500'];
      for (let i = 0; i < 100; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = Math.random() * 100 + 'vw';
          confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
          confetti.style.animationDelay = (Math.random() * 0.5) + 's';
          document.body.appendChild(confetti);
          
          setTimeout(() => confetti.remove(), 5000);
        }, i * 30);
      }
    }

    // Audio
    function playAudio() {
      const audio = document.getElementById('audio');
      audio.play().catch(() => {
        console.log('[v0] Audio autoplay blocked');
      });
    }

    // Reset para pruebas (presiona R)
    document.addEventListener('keydown', (e) => {
      if (e.key.toLowerCase() === 'r') {
        if (confirm('¬øReiniciar calendario? (Solo para pruebas)')) {
          localStorage.removeItem(STORAGE_KEY);
          location.reload();
        }
      }
    });

    // Inicializar
    createBoxes();
  </script>

</body>
</html>
